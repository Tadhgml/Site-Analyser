// frontend/src/components/dashboard/VulnerabilityChart.js

import React from 'react';
import { Chart as ChartJS, ArcElement, Tooltip, Legend } from 'chart.js';
import { Pie } from 'react-chartjs-2';

// Register ChartJS components
ChartJS.register(ArcElement, Tooltip, Legend);

const VulnerabilityChart = ({ vulnerabilities }) => {
  // Extract severity counts
  const severityCounts = {
    critical: vulnerabilities.critical || 0,
    high: vulnerabilities.high || 0,
    medium: vulnerabilities.medium || 0,
    low: vulnerabilities.low || 0,
    info: vulnerabilities.info || 0,
  };
  
  const data = {
    labels: ['Critical', 'High', 'Medium', 'Low', 'Info'],
    datasets: [
      {
        data: [
          severityCounts.critical,
          severityCounts.high,
          severityCounts.medium,
          severityCounts.low,
          severityCounts.info,
        ],
        backgroundColor: [
          '#dc3545', // Critical - Danger red
          '#fd7e14', // High - Orange
          '#ffc107', // Medium - Warning yellow
          '#6c757d', // Low - Secondary gray
          '#0dcaf0', // Info - Info blue
        ],
        borderColor: [
          '#fff',
          '#fff',
          '#fff',
          '#fff',
          '#fff',
        ],
        borderWidth: 1,
      },
    ],
  };
  
  const options = {
    plugins: {
      legend: {
        position: 'bottom',
      },
    },
    maintainAspectRatio: false,
  };
  
  const totalIssues = Object.values(severityCounts).reduce((a, b) => a + b, 0);
  
  return (
    <div className="card h-100">
      <div className="card-body">
        <h5 className="card-title">Vulnerability Summary</h5>
        
        {totalIssues === 0 ? (
          <div className="text-center my-5">
            <div className="text-success mb-3">
              <i className="bi bi-check-circle" style={{ fontSize: '3rem' }}></i>
            </div>
            <p>No vulnerabilities found!</p>
          </div>
        ) : (
          <div className="mt-3" style={{ height: '240px' }}>
            <Pie data={data} options={options} />
          </div>
        )}
      </div>
    </div>
  );
};

export default VulnerabilityChart;